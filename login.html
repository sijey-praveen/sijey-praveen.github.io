<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta name="language" content="EN">
        <meta http-equiv="Cache-Control" content="no-cache">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <style>
            * {margin: 0;transition: 0.4s;}
            html {scroll-behavior: smooth;}
            .text {padding: 5px;}
            .login-with-google-btn {display: flex;align-items: center;justify-content: center;border: 1px solid #ccc;border-radius: 4px;width: 240px;padding: 4px 10px 4px 10px;margin: 10px;cursor: pointer;}
            .login-with-google-btn img {width: 25px;padding: 5px;}
            .center {display: flex;align-items: center;justify-content: center;flex-direction: column;}
            .container {border: 1px solid #ccc;width: max-content;padding: 10px;display: flex;align-items: center;justify-content: center;flex-direction: column;margin: 10px;border-radius: 4px;}
            .login-btn {padding: 10px;margin: 10px;border: 1px solid #ccc;cursor: pointer;width: 60px;text-align: center;border-radius: 4px;width: 240px;}
            input {outline: none;margin: 10px;padding: 10px;width: 240px;border: none;border-radius: 4px;border: 1px solid #ccc;}
        </style>
    </head>
    <body accesstype="humans">
        <section class="center">
            <div class="container">
                <input type="email" id="email" placeholder="Email">
                <div class="login-btn">Login To Continue</div>
                <div class="login-with-google-btn">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/1024px-Google_%22G%22_Logo.svg.png">
                    <div class="text">Login with Google</div>
                </div>
            </div>    
        </section>
        <script>
            document.title = "Login To Continue - Sijey Praveen"

            var CODE = new URLSearchParams(window.location.search).get("code")
            const CLIENT_ID = "404659966063-65vvtn6is4qcpairvvvm0pltma690hho.apps.googleusercontent.com"
            const CLIENT_SECRET = "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"
            const REDIRECT_URI = "https://sijey-praveen.netlify.app/login/"

            $(".login-btn").click(
                function() {
                    var email = document.getElementById("email").value
                    if (email === null) {
                        alert("please enter your email")
                    } else {
                        try {
                            document.cookie = `email=${email};sameSite=Lax`
                            document.cookie = "avatar=https://www.pngkey.com/png/full/115-1150152_default-profile-picture-avatar-png-green.png;sameSite=Lax"
                            window.location.replace("https://sijey-praveen.netlify.app/")
                        } catch(err) {
                            console.log(err)
                        }                    
                    }
                }
            )

            if (CODE === null) {
            } else {
                loginwithGoogle(CODE)
            }

            $(".login-with-google-btn").click(
                function() {
                    window.location.replace(`https://accounts.google.com/o/oauth2/auth?scope=https://www.googleapis.com/auth/userinfo.email&response_type=code&access_type=offline&redirect_uri=${REDIRECT_URI}&client_id=${CLIENT_ID}`)
                }
            )
            
            function loginwithGoogle(code) {
                data = {
                    "code": code,
                    "client_id": CLIENT_ID,
                    "client_secret": CLIENT_SECRET,
                    "redirect_uri": REDIRECT_URI,
                    "grant_type": "authorization_code"
                }

                $.post("https://oauth2.googleapis.com/token", data,
                    function(access_token) {
                        var access_token = JSON.parse(JSON.stringify(access_token)).access_token
                        $.get(`https://www.googleapis.com/oauth2/v3/userinfo?access_token=${access_token}`,
                            function(user_private) {
                                var user_private = JSON.parse(JSON.stringify(user_private))
                                try {
                                    document.cookie = `email=${user_private.email};sameSite=Lax`
                                    document.cookie = `avatar=${user_private.picture};sameSite=Lax`
                                    window.location.replace("https://sijey-praveen.netlify.app/")
                                } catch(err) {
                                    console.log(err)
                                }
                            }
                        )
                    }
                )
            }

        </script>        
    </body>
</html>
